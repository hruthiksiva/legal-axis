# Firestore Case Schema Documentation

This document describes the comprehensive Firestore case schema implemented for the Legal Axis application.

## Schema Overview

The case schema includes all the requested fields plus additional useful fields for a complete legal case management system.

### Core Fields

- **caseId**: Unique identifier for the case (auto-generated by Firestore)
- **clientId**: ID of the client who owns the case
- **caseTitle**: Title/name of the case
- **caseDescription**: Detailed description of the case
- **milestones**: Array of milestone objects with progress tracking
- **createdAt**: Timestamp when the case was created
- **updatedAt**: Timestamp when the case was last updated

### Milestone Structure

Each milestone in the `milestones` array contains:

```typescript
interface Milestone {
  milestoneId: string;           // Unique identifier
  title: string;                 // Milestone title
  description: string;           // Milestone description
  amount: number;                // Cost amount for this milestone
  status: MilestoneStatus;       // Pending | In Progress | Completed
  createdAt?: Timestamp;         // When milestone was created
  updatedAt?: Timestamp;         // When milestone was last updated
  dueDate?: Timestamp;           // Optional due date
  completedAt?: Timestamp;       // When milestone was completed
}
```

### Additional Fields

- **status**: Overall case status (Open, In Progress, Closed, On Hold)
- **category**: Case category (Family Law, Criminal Law, etc.)
- **priority**: Priority level (Low, Medium, High, Urgent)
- **assignedLawyerId**: ID of the lawyer assigned to the case
- **totalAmount**: Total amount for all milestones
- **tags**: Array of tags for categorization
- **documents**: Array of document URLs
- **notes**: Additional notes about the case

## Usage Examples

### Creating a New Case

```typescript
import { createCaseInFirestore } from '../services/caseService';
import { MilestoneStatus } from '../types/case';

const newCase = {
  clientId: 'client123',
  caseTitle: 'Divorce Settlement',
  caseDescription: 'Handling divorce settlement for client',
  milestones: [
    {
      title: 'Initial Consultation',
      description: 'First meeting with client',
      amount: 150,
      status: MilestoneStatus.PENDING
    },
    {
      title: 'Document Preparation',
      description: 'Prepare legal documents',
      amount: 500,
      status: MilestoneStatus.PENDING
    }
  ],
  category: 'Family Law',
  priority: 'Medium'
};

const caseId = await createCaseInFirestore(newCase);
```

### Updating a Case

```typescript
import { updateCaseInFirestore } from '../services/caseService';

await updateCaseInFirestore('caseId123', {
  status: 'In Progress',
  priority: 'High'
});
```

### Adding a Milestone

```typescript
import { addMilestoneToCase } from '../services/caseService';

await addMilestoneToCase('caseId123', {
  title: 'Court Filing',
  description: 'File documents with court',
  amount: 200,
  status: MilestoneStatus.PENDING
});
```

### Updating Milestone Status

```typescript
import { updateMilestoneStatus, MilestoneStatus } from '../services/caseService';

await updateMilestoneStatus('caseId123', 'milestoneId456', MilestoneStatus.COMPLETED);
```

### Getting Cases

```typescript
import { getCasesByClientId, getAllCases } from '../services/caseService';

// Get all cases for a client
const clientCases = await getCasesByClientId('client123');

// Get all cases with filters
const openCases = await getAllCases({ status: 'Open', limit: 10 });
```

## Utility Functions

The schema includes utility functions for common operations:

- **calculateCaseStats**: Calculate progress and statistics
- **getMilestonesByStatus**: Filter milestones by status
- **getOverdueMilestones**: Find overdue milestones
- **validateCase**: Validate case data before saving

## Firestore Security Rules

Make sure to set up appropriate Firestore security rules:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /cases/{caseId} {
      allow read: if request.auth != null && 
        (resource.data.clientId == request.auth.uid || 
         resource.data.assignedLawyerId == request.auth.uid);
      allow create: if request.auth != null && 
        request.resource.data.clientId == request.auth.uid;
      allow update: if request.auth != null && 
        (resource.data.clientId == request.auth.uid || 
         resource.data.assignedLawyerId == request.auth.uid);
      allow delete: if request.auth != null && 
        resource.data.clientId == request.auth.uid;
    }
  }
}
```

## Type Safety

All functions are fully typed with TypeScript interfaces, providing:

- Compile-time type checking
- IntelliSense support
- Runtime validation
- Error handling

## Migration from Old Schema

If you have existing cases with the old schema, you'll need to migrate them. The utility functions include helpers for this:

```typescript
// Example migration function
const migrateOldCase = (oldCase: any) => {
  return {
    caseId: oldCase.id,
    clientId: oldCase.clientId,
    caseTitle: oldCase.title,
    caseDescription: oldCase.description,
    milestones: oldCase.milestones || [],
    createdAt: oldCase.createdAt,
    updatedAt: oldCase.updatedAt,
    status: oldCase.status,
    category: oldCase.category,
    // ... other fields
  };
};
``` 